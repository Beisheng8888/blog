import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as s,e}from"./app-26096568.js";const t="data:image/png;base64,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",i="/blog/assets/image-20210618201412878-2953d56a.png",p="/blog/assets/image-20210618201607831-68fdf823.png",c="/blog/assets/image-20210618201726280-5eb956fa.png",o="/blog/assets/image-20210618201912078-86a6565f.png",l="/blog/assets/image-20210618202047575-3d201c04.png",r="/blog/assets/image-20210618202322301-b7ba23c1.png",d="/blog/assets/image-20210618202334536-ef3faf14.png",g="/blog/assets/image-20210618202433356-d5c9a330.png",u="/blog/assets/image-20210618202449881-4f031e1f.png",m="/blog/assets/image-20210618202501928-649d9e33.png",h="/blog/assets/image-20210618202701492-39a55f14.png",b={},k=e(`<h1 id="sentinel-规则持久化" tabindex="-1"><a class="header-anchor" href="#sentinel-规则持久化" aria-hidden="true">#</a> Sentinel 规则持久化</h1><h2 id="一、修改order-service服务" tabindex="-1"><a class="header-anchor" href="#一、修改order-service服务" aria-hidden="true">#</a> 一、修改order-service服务</h2><p>修改OrderService，让其监听Nacos中的sentinel规则配置。</p><p>具体步骤如下：</p><h3 id="_1-引入依赖" tabindex="-1"><a class="header-anchor" href="#_1-引入依赖" aria-hidden="true">#</a> 1.引入依赖</h3><p>在order-service中引入sentinel监听nacos的依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-配置nacos地址" tabindex="-1"><a class="header-anchor" href="#_2-配置nacos地址" aria-hidden="true">#</a> 2.配置nacos地址</h3><p>在order-service中的application.yml文件配置nacos地址及监听的配置信息：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">flow</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacos地址</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> orderservice<span class="token punctuation">-</span>flow<span class="token punctuation">-</span>rules
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow <span class="token comment"># 还可以是：degrade、authority、param-flow</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="二、修改sentinel-dashboard源码" tabindex="-1"><a class="header-anchor" href="#二、修改sentinel-dashboard源码" aria-hidden="true">#</a> 二、修改sentinel-dashboard源码</h2><p>SentinelDashboard默认不支持nacos的持久化，需要修改源码。</p><h3 id="_1-解压" tabindex="-1"><a class="header-anchor" href="#_1-解压" aria-hidden="true">#</a> 1. 解压</h3><p>解压课前资料中的sentinel源码包：</p><figure><img src="`+t+'" alt="image-20210618201340086" tabindex="0" loading="lazy"><figcaption>image-20210618201340086</figcaption></figure><p>然后并用IDEA打开这个项目，结构如下：</p><figure><img src="'+i+'" alt="image-20210618201412878" tabindex="0" loading="lazy"><figcaption>image-20210618201412878</figcaption></figure><h3 id="_2-修改nacos依赖" tabindex="-1"><a class="header-anchor" href="#_2-修改nacos依赖" aria-hidden="true">#</a> 2. 修改nacos依赖</h3><p>在sentinel-dashboard源码的pom文件中，nacos的依赖默认的scope是test，只能在测试时使用，这里要去除：</p><figure><img src="'+p+`" alt="image-20210618201607831" tabindex="0" loading="lazy"><figcaption>image-20210618201607831</figcaption></figure><p>将sentinel-datasource-nacos依赖的scope去掉：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-添加nacos支持" tabindex="-1"><a class="header-anchor" href="#_3-添加nacos支持" aria-hidden="true">#</a> 3. 添加nacos支持</h3><p>在sentinel-dashboard的test包下，已经编写了对nacos的支持，我们需要将其拷贝到main下。</p><figure><img src="`+c+'" alt="image-20210618201726280" tabindex="0" loading="lazy"><figcaption>image-20210618201726280</figcaption></figure><h3 id="_4-修改nacos地址" tabindex="-1"><a class="header-anchor" href="#_4-修改nacos地址" aria-hidden="true">#</a> 4. 修改nacos地址</h3><p>然后，还需要修改测试代码中的NacosConfig类：</p><figure><img src="'+o+'" alt="image-20210618201912078" tabindex="0" loading="lazy"><figcaption>image-20210618201912078</figcaption></figure><p>修改其中的nacos地址，让其读取application.properties中的配置：</p><figure><img src="'+l+`" alt="image-20210618202047575" tabindex="0" loading="lazy"><figcaption>image-20210618202047575</figcaption></figure><p>在sentinel-dashboard的application.properties中添加nacos地址配置：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">nacos.addr</span><span class="token punctuation">=</span><span class="token value attr-value">localhost:8848</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-配置nacos数据源" tabindex="-1"><a class="header-anchor" href="#_5-配置nacos数据源" aria-hidden="true">#</a> 5. 配置nacos数据源</h3><p>另外，还需要修改com.alibaba.csp.sentinel.dashboard.controller.v2包下的FlowControllerV2类：</p><figure><img src="`+r+'" alt="image-20210618202322301" tabindex="0" loading="lazy"><figcaption>image-20210618202322301</figcaption></figure><p>让我们添加的Nacos数据源生效：</p><figure><img src="'+d+'" alt="image-20210618202334536" tabindex="0" loading="lazy"><figcaption>image-20210618202334536</figcaption></figure><h3 id="_6-修改前端页面" tabindex="-1"><a class="header-anchor" href="#_6-修改前端页面" aria-hidden="true">#</a> 6. 修改前端页面</h3><p>接下来，还要修改前端页面，添加一个支持nacos的菜单。</p><p>修改src/main/webapp/resources/app/scripts/directives/sidebar/目录下的sidebar.html文件：</p><figure><img src="'+g+'" alt="image-20210618202433356" tabindex="0" loading="lazy"><figcaption>image-20210618202433356</figcaption></figure><p>将其中的这部分注释打开：</p><figure><img src="'+u+'" alt="image-20210618202449881" tabindex="0" loading="lazy"><figcaption>image-20210618202449881</figcaption></figure><p>修改其中的文本：</p><figure><img src="'+m+'" alt="image-20210618202501928" tabindex="0" loading="lazy"><figcaption>image-20210618202501928</figcaption></figure><h3 id="_7-重新编译、打包项目" tabindex="-1"><a class="header-anchor" href="#_7-重新编译、打包项目" aria-hidden="true">#</a> 7. 重新编译、打包项目</h3><p>运行IDEA中的maven插件，编译和打包修改好的Sentinel-Dashboard：</p><figure><img src="'+h+`" alt="image-20210618202701492" tabindex="0" loading="lazy"><figcaption>image-20210618202701492</figcaption></figure><h3 id="_8-启动" tabindex="-1"><a class="header-anchor" href="#_8-启动" aria-hidden="true">#</a> 8.启动</h3><p>启动方式跟官方一样：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果要修改nacos地址，需要添加参数：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> <span class="token parameter variable">-Dnacos.addr</span><span class="token operator">=</span>localhost:8848 sentinel-dashboard.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,53),v=[k];function f(I,z){return n(),s("div",null,v)}const S=a(b,[["render",f],["__file","sentinel规则持久化.html.vue"]]);export{S as default};
